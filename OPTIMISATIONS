changed mmap to be closer
don't inline the register push
